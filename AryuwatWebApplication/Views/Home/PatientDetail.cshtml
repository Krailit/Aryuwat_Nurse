@using AryuwatWebApplication.Models
@{
    ViewBag.Title = "Patient Detail";
}
<script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<style>
    .swal2-popup {
        font-size: 20px;
    }
</style>
<div id="app" style="font-size:18px">
    <div class="container" style="background-color:#f3f3f3;margin-top: -20px;padding-top: 10px; padding-bottom: 30px">
        <div class="row">
            <div class="col-lg-1">
                <a href="@Url.Content("~/Home/Index")"><i class="fa fa-angle-left"></i></a>
            </div>
            <div class="col-lg-11">
                <u style="font-size:24px; font-weight:600">{{tmpCustomer.Tname + ' ' + tmpCustomer.TsurName}}</u>
            </div>
            <div class="col-lg-1">
            </div>
            <div class="col-lg-11">
                <p style="font-size:18px;">CN : {{tmpCustomer.CN}}</p>
            </div>
        </div>
    </div>
    <div class="container" style="background-color:#e6e6e6;">
        <div class="row color-text" style="margin-top: 5rem;margin-bottom: 5rem;margin-left: 10px;margin-right: 10px;">
            <div class="col-lg-6">
                <div class="card" style="margin:20px;height:200px;background-color:white;cursor:pointer;border-top: 90px solid #C8C8C8;border-radius:10px" v-on:click="PatientData()">
                    <div class="card-body" style="padding-top:20px">
                        <h2><b>ตรวจวัดข้อมูลผู้ป่วย</b></h2>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card" style="margin:20px;height:200px;background-color:white;cursor:pointer;border-top: 90px solid #C8C8C8;border-radius:10px" v-on:click="MedicalExpire()">
                    <div class="card-body" style="padding-top:20px">
                        <h2><b>วันหมดอายุเวชภัณฑ์</b></h2>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card" style="margin:20px;height:200px;background-color:white;border-top: 90px solid #C8C8C8;border-radius:10px;cursor:pointer" v-on:click="AttachfilePatient()">
                    <div class="card-body" style="padding-top:20px">
                        <h2><b>ภาพแนบผู้ป่วย</b></h2>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card" style="margin:20px;height:200px;background-color:white;border-top: 90px solid #C8C8C8;border-radius:10px;cursor:pointer" v-on:click="Remark()">
                    <div class="card-body" style="padding-top:20px">
                        <h2><b>แจ้งเตือน Remark และแจ้งเตือนการกินยา</b></h2>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card" style="margin:20px;height:200px;background-color:white;border-top: 90px solid #C8C8C8;border-radius:10px;cursor:pointer" v-on:click="Meeting()">
                    <div class="card-body" style="padding-top:20px">
                        <h2><b>Meeting ผู้ป่วย</b></h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/Scripts/vue.js"></script>
<script src="~/Scripts/axios.js"></script>
<script>
    Vue.prototype.$http = axios;
    const app = new Vue({
        el: "#app",
        data: {
            tmpCustomer : @Html.Raw(Json.Encode(@Model)),
            txttest : '',
        },
        mounted: function () {
            var that = this;
            if (that.tmpCustomer.CN == null) {
                window.location.href = '@Url.Content("~/Home/Index")';
            }
            that.CheckRemark();
        },
        watch: {
        },
        methods: {
            CheckRemark: async function () {
                var that = this;
                that.$http.post('@Url.Action("CheckRemark", "Home")', {
                    tmpCustomerID: that.tmpCustomer.ID
                }).then(function(response)
                {
                    if (response.data.ContentEncoding == 200) {
                        var msgRemark = "<p style='color:red'>";
                        var msgRemark1 = "";
                        var msgRemark2 = "";
                        var msgTODO = "<p style='color:blue'>";
                        var msgMED = "<p style='color:green'>";
                        var chkType1 = false;
                        var chkType2 = false;
                        response.data.data.RemarkData.forEach(async function (rm) {
                            if (rm.Remark_Type == 1) {
                                chkType1 = true;
                                msgRemark1 += '<br>' + rm.Topic + ' : ' + rm.Description + '<br>';
                            }
                            if (rm.Remark_Type == 2) {
                                chkType2 = true;
                                msgRemark2 += '<br>' + rm.Topic + ' : ' + rm.Description + '<br>';

                            }
                        });
                        if (chkType1) {
                            msgRemark += '<b>Remark :</b><br>' + msgRemark1;
                        }
                        if (chkType2) {
                            msgMED += '<b>MED :</b><br>' + msgRemark2;
                        }

                        if (response.data.data.PatientChangeData.length > 0) {
                            msgTODO += '<b>TODO :</b><br>';
                        }
                        response.data.data.PatientChangeData.forEach(async function (pc) {
                            if (pc.Type == 1) {
                                msgTODO += '<br>เปลี่ยนท่ออาหาร<br>';
                            }
                            if (pc.Type == 2) {
                                msgTODO += '<br>เปลี่ยนท่อปัสสวะ<br>';
                            }
                        });
                        msgRemark += "</p>";
                        msgTODO += "</p>";
                        msgMED += "</p>";
                        Swal.fire({
                            html: msgRemark + '<br>' +
                                  msgTODO + '<br>' +
                                  msgMED,
                            icon: 'warning',
                            confirmButtonText: 'Close',
                            allowOutsideClick: false
                        })
                    }
                });
            },
            AttachfilePatient: function () {
                window.location.href = '@Url.Content("~/Home/Attachfile")?customerCN=' + this.tmpCustomer.CN;
            },
            Remark: function () {
                window.location.href = '@Url.Content("~/Home/Remark")?customerCN=' + this.tmpCustomer.CN;
            },
            Meeting: function () {
                window.location.href = '@Url.Content("~/Home/Meeting")?customerCN=' + this.tmpCustomer.CN;
            },
            MedicalExpire: function () {
                window.location.href = '@Url.Content("~/Home/MedicalExpire")?customerCN=' + this.tmpCustomer.CN;
            },
            PatientData: function () {
                window.location.href = '@Url.Content("~/Home/PatientData")?customerCN=' + this.tmpCustomer.CN;
            },
        }
    });
</script>
